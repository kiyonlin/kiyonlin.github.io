(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{267:function(s,t,n){"use strict";n.r(t);var a=n(2),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[n("p",[s._v("原文"),n("a",{attrs:{href:"http://linux.kiyon.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("鸟哥的 Linux私房菜"),n("OutboundLink")],1)]),s._v(" "),s._m(0),s._v(" "),n("p",[s._v("LVM 的全名是Logical Volume Manager，逻辑卷轴管理员。LVM 的作法是将几个物理的partitions (或disk) 通过软件组合成为一块看起来是独立的大磁盘(VG) ，然后将这块大磁盘再经过分割成为可使用分区(LV)，最终就能够挂载使用了。但是为什么这样的系统可以进行filesystem 的扩充或缩小呢？其实与一个称为PE 的项目有关。")]),s._v(" "),s._m(1),s._v(" "),n("p",[s._v("我们实际的partition (或Disk)需要调整系统识别码(system ID)成为8e (LVM的识别码)，然后再经过pvcreate的指令将它转成LVM最底层的物理卷轴(PV) ，之后才能够将这些PV加以利用！调整system ID的方是就是通过gdisk进行！")]),s._v(" "),s._m(2),s._v(" "),n("p",[s._v("所谓的LVM 大磁盘就是将许多PV 整合成这个VG ！所以VG 就是LVM 组合起来的大磁盘！那么这个大磁盘最大可以到多少容量呢？这与底下要说明的PE 以及LVM 的格式版本有关。在预设的情况下， 使用32位的Linux 系统时，基本上LV 最大仅能支持到65534 个PE 而已，若使用预设的PE为4MB 的情况下， 最大容量则仅能达到约256GB 而已。不过，这个问题在64位的Linux 系统上面已经不存在了！LV 几乎没有啥容量限制！")]),s._v(" "),s._m(3),s._v(" "),n("p",[s._v("LVM预设使用4MB的PE区块，而LVM的LV在32位系统上最多仅能含有65534个PE (lvm1的格式)，因此预设的LVM的LV会有4M*65534/(1024M/G )=256G。PE是整个LVM最小的储存区块，也就是说，其实我们的文件资料都是藉由写入PE来处理的。简单的说，这个PE就有点像文件系统里面的block大小。所以调整PE会影响到LVM的最大容量！不过，在CentOS 6.x以后，由于直接使用lvm2的各项格式功能，以及系统转为64位，因此这个限制已经不存在了。")]),s._v(" "),s._m(4),s._v(" "),n("p",[s._v("最终的VG还会被切成LV，这个LV就是最后可以被格式化使用的类似分区的东西！那么LV是否可以随意指定大小呢？当然不可以！既然PE是整个LVM的最小储存单位，那么LV的大小就与在此LV内的PE总数有关。为了方便使用者利用LVM来管理其系统，因此LV的设备档名通常指定为『 /dev/vgname/lvname』的样式！")]),s._v(" "),n("p",[s._v("此外，我们刚刚有谈到LVM 可弹性的变更filesystem 的容量，那是如何办到的？其实就是通过『交换PE 』来进行资料转换， 将原本LV 内的PE 移转到其他设备中以降低LV 容量，或将其他设备的PE 加到此LV 中以加大容量！")]),s._v(" "),s._m(5),s._v(" "),s._m(6),s._v(" "),s._m(7),n("p",[s._v("上面的/dev/sda{5,6,7,8} 这4 个分区就是我们的物理分区！也就是底下会实际用到的信息！至于/dev/sda9 则先保留下来不使用。注意看，那个8e 的出现会导致system 变成『 Linux LVM 』！其实没有设定成为8e 也没关系， 不过某些LVM 的侦测指令可能会侦测不到该partition。")]),s._v(" "),s._m(8),s._v(" "),n("p",[s._v("要建立PV 其实很简单，只要直接使用pvcreate 即可！")]),s._v(" "),s._m(9),s._v(" "),s._m(10),s._m(11),s._v(" "),s._m(12),s._v(" "),n("p",[s._v("与PV 不同的是， VG 的名称是自定义的！我们知道PV 的名称其实就是partition 的设备文件名， 但是这个VG 名称则可以随便自己取。建立这个 VG 的流程是这样的：")]),s._v(" "),s._m(13),n("p",[s._v("这样就建立一个VG 了！假设我们要增加这个VG 的容量，因为我们还有/dev/sda8 ！此时可以这样做：")]),s._v(" "),s._m(14),s._m(15),s._v(" "),n("p",[s._v("创造出VG 这个大磁盘之后，再来就是要建立分割区啦！这个分割区就是所谓的LV ！假设我要将刚刚那个 kiyonvg 磁盘，分割成为kiyonlv ，整个VG 的容量都被分配到kiyonlv 里面去。")]),s._v(" "),s._m(16),s._v(" "),s._m(17),s._v(" "),s._m(18),s._v(" "),s._m(19),n("p",[s._v("如此一来，整个LV partition也准备好了！接下来，就是针对这个LV来处理！要特别注意的是， VG的名称为kiyonvg ，但是LV的名称必须使用全名/dev/kiyonvg/kiyonlv才对！后续的处理都是这样的！")]),s._v(" "),s._m(20),s._v(" "),s._m(21),s._m(22),s._v(" "),s._m(23),s._v(" "),n("p",[s._v("针对/srv/lvm 再增加500M 的容量")]),s._v(" "),s._m(24),n("p",[s._v("最终的结果中LV 真的有放大到2.5GB ！但是文件系统却没有相对增加！我们的LVM 可以线上直接处理，并不需要特别umount ！使用xfs_growfs 来处理一下！")]),s._v(" "),s._m(25),n("p",[s._v("在上表中，注意看两次xfs_info 的结果，你会发现到1)整个block group (agcount) 的数量增加一个！那个block group 就是纪录新的设备容量之文件系统所在！而你也会2)发现整体的block 数量增加了！这样整个文件系统就给他放大了！同时，使用df 去查阅时，就真的看到增加的量了！文件系统的放大可以在On-line 的环境下操作。")]),s._v(" "),n("p",[s._v("目前的XFS 文件系统中，并没有缩小文件系统容量的设计！也就是说，文件系统只能放大不能缩小喔！如果你想要保有放大、缩小的本事， 那还请回去使用EXT 家族最新的EXT4 文件系统啰！XFS 目前是办不到的！")]),s._v(" "),s._m(26),s._v(" "),n("p",[s._v("LVM thin Volume 的概念是：先建立一个可以实支实付、用多少容量才分配实际写入多少容量的磁盘容量储存池(thin pool)， 然后再由这个thin pool 去产生一个『指定要固定容量大小的LV 设备』，这个LV 就有趣了！虽然你会看到『表面上，它的容量可能有10GB ，但实际上， 该设备用到多少容量时，才会从thin pool 去实际取得所需要的容量』！可能thin pool 仅有1GB 的容量， 但是可以分配给一个10GB 的LV 设备！而该设备实际使用到500M 时，整个thin pool 才分配500M 给该LV ！当然啦！在所有由thin pool 所分配出来的LV 设备中，总实际使用量绝不能超过thin pool 的最大实际容量！如这个案例说的， thin pool 仅有1GB， 那所有的由这个thin pool 建置出来的LV 设备内的实际用量，就绝不能超过1GB ！")]),s._v(" "),n("p",[s._v("实际操作：")]),s._v(" "),s._m(27),s._v(" "),s._m(28),n("p",[s._v("这就是用多少算多少的thin pool 操作方式！基本上，用来骗人挺吓人的！小小的一个磁盘可以模拟出好多容量！但实际上，真的可用容量就是实际的磁盘储存池内的容量！如果突破该容量，这个thin pool 可是会爆炸而让资料损毁！要注意！要注意！")]),s._v(" "),s._m(29),s._v(" "),n("p",[s._v("快照就是将当时的系统信息记录下来，就好像照相记录一般！未来若有任何资料更动了，则原始资料会被搬移到快照区，没有被更动的区域则由快照区与文件系统共享。\n快照区与被快照的LV必须要在同一个VG上头。")]),s._v(" "),s._m(30),s._v(" "),s._m(31),n("p",[s._v("/dev/kiyonvg/kiyonsnap1 快照区就被建立起来了！而且它的VG 量与原本的/dev/kiyonvg/kiyonlv 相同！也就是说，如果真的挂载这个设备时，看到的资料会跟原本的kiyonlv 相同！")]),s._v(" "),s._m(32),n("p",[s._v("因为XFS 不允许相同的UUID 文件系统的挂载，因此得要加上那个nouuid 的参数，让文件系统忽略相同的UUID 所造成的问题！")]),s._v(" "),s._m(33),s._v(" "),n("p",[s._v("要注意的是，要复原的资料量不能够高于快照区所能负载的实际容量。由于原始资料会被搬移到快照区，如果快照区不够大，若原始资料被更动的实际资料量比快照区大，那么快照区当然容纳不了，这时候快照功能会失效！")]),s._v(" "),n("p",[s._v("我们的/srv/lvm 已经有/srv/lvm/etc, /srv/lvm/log 等目录了，接下来将这个文件系统的内容作个变更， 然后再以快照区资料还原看看：")]),s._v(" "),s._m(34),n("p",[s._v("为什么要备份呢？为什么不可以直接格式化/dev/kiyonvg/kiyonlv 然后将/dev/kiyonvg/kiyonsnap1 直接复制给kiyonlv 呢？要知道kiyonsnap1 其实是kiyonlv 的快照，因此如果你格式化整个kiyonlv 时，原本的文件系统所有资料都会被搬移到kiyonsnap1。那如果kiyonsnap1 的容量不够大(通常也真的不够大)，那么部分资料将无法复制到kiyonsnap1 内，资料当然无法全部还原啊！所以才要在上面制作出一个备份文件！")]),s._v(" "),n("p",[s._v("而快照还有另外一个功能，就是你可以比对/srv/lvm 与/srv/snapshot1 的内容，就能够发现到最近你到底改了啥！")]),s._v(" "),s._m(35),s._m(36),s._v(" "),n("p",[s._v("如果没有将LVM 关闭就直接将那些partition 删除或转为其他用途的话，系统是会发生很大的问题的！所以必须要知道如何将LVM 的设备关闭并移除才行！依据以下的流程来处理即可：")]),s._v(" "),s._m(37),s._v(" "),s._m(38)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"什么是lvm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是lvm","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是LVM")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"physical-volume-pv-物理卷轴"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#physical-volume-pv-物理卷轴","aria-hidden":"true"}},[this._v("#")]),this._v(" Physical Volume, PV, 物理卷轴")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"volume-group-vg-卷轴群组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#volume-group-vg-卷轴群组","aria-hidden":"true"}},[this._v("#")]),this._v(" Volume Group, VG, 卷轴群组")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"physical-extent-pe-物理范围区块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#physical-extent-pe-物理范围区块","aria-hidden":"true"}},[this._v("#")]),this._v(" Physical Extent, PE, 物理范围区块")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"logical-volume-lv-逻辑卷轴"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#logical-volume-lv-逻辑卷轴","aria-hidden":"true"}},[this._v("#")]),this._v(" Logical Volume, LV, 逻辑卷轴")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"lvm-操作流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvm-操作流程","aria-hidden":"true"}},[this._v("#")]),this._v(" LVM 操作流程")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_0-disk-阶段-实际的磁盘"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-disk-阶段-实际的磁盘","aria-hidden":"true"}},[this._v("#")]),this._v(" 0. Disk 阶段(实际的磁盘)")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# gdisk -l /dev/vda")]),s._v("\nNumber  Start "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    End "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sector"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  Size       Code  Name\n   1            2048            6143   2.0 MiB     EF02\n   2            6144         2103295   1024.0 MiB  0700\n   3         2103296        65026047   30.0 GiB    8E00\n   4        65026048        67123199   1024.0 MiB  8300  Linux filesystem\n   5        75511808        77608959   1024.0 MiB  8E00  Linux LVM\n   6        69220352        71317503   1024.0 MiB  8E00  Linux LVM\n   7        71317504        73414655   1024.0 MiB  8E00  Linux LVM\n   8        73414656        75511807   1024.0 MiB  8E00  Linux LVM\n   9        77608960        79706111   1024.0 MiB  8E00  Linux LVM\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 其实system ID不改变也没关系！只是为了让我们管理员清楚知道该partition的内容，")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 所以这里建议还是修改成正确的磁盘内容较好！")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_1-pv-阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-pv-阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. PV 阶段")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("pvcreate ：将物理partition 建立成为PV ；")]),this._v(" "),t("li",[this._v("pvscan ：搜寻目前系统里面任何具有PV 的磁盘；")]),this._v(" "),t("li",[this._v("pvdisplay ：显示出目前系统上面的PV 状态；")]),this._v(" "),t("li",[this._v("pvremove ：将PV 属性移除，让该partition 不具有PV 属性。")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 1.检查有无PV在系统上，然后将/dev/sda{5-8}建立成为PV格式 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvscan")]),s._v("\n  PV /dev/sda3   VG centos          lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB / 14.00 GiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    Total: 1 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" use: 1 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" no VG: 0 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0   "),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 其实安装的时候，我们就有使用LVM 了喔！所以会有/dev/vda3 存在的！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvcreate /dev/sda{5,6,7,8}")]),s._v("\n  Physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda5"')]),s._v(" successfully created.\n  Physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda6"')]),s._v(" successfully created.\n  Physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda7"')]),s._v(" successfully created.\n  Physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda8"')]),s._v(" successfully created.\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 这个指令可以一口气建立这四个partition 成为PV ！注意大括号的用途")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvscan")]),s._v("\n  PV /dev/sda3   VG centos          lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB / 14.00 GiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda7                      lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda8                      lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda6                      lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda5                      lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  Total: 5 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("34.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" use: 1 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" no VG: 4 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("4.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 这就分别显示每个PV 的信息与系统所有PV 的信息。尤其最后一行，显示的是：")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 整体PV 的量 / 已经被使用到VG 的PV 量 / 剩余的PV 量")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 2.更详细的列示出系统上面每个PV的个别信息： ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvdisplay /dev/sda5")]),s._v("\n  "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda5"')]),s._v(" is a new physical volume of "),n("span",{attrs:{class:"token string"}},[s._v('"1.00 GiB"')]),s._v("\n  --- NEW Physical volume ---\n  PV Name               /dev/sda5\n  VG Name\n  PV Size               1.00 GiB\n  Allocatable           NO\n  PE Size               0\n  Total PE              0\n  Free PE               0\n  Allocated PE          0\n  PV UUID               hiIqyY-CcAj-qImn-6MWn-07Ed-XJgf-3wzMul\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 由于PE 是在建立VG 时才给予的参数，因此在这里看到的PV 里头的PE 都会是 0")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 而且也没有多余的PE 可供分配(allocatable)。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_2-vg-阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-vg-阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. VG 阶段")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ul",[n("li",[s._v("vgcreate ：建立VG 的指令。")]),s._v(" "),n("li",[s._v("vgscan ：搜寻系统上面是否有VG 存在；")]),s._v(" "),n("li",[s._v("vgdisplay ：显示目前系统上面的VG 状态；")]),s._v(" "),n("li",[s._v("vgextend ：在VG 内增加额外的PV ；")]),s._v(" "),n("li",[s._v("vgreduce ：在VG 内移除PV；")]),s._v(" "),n("li",[s._v("vgchange ：设定VG 是否启动(active)；")]),s._v(" "),n("li",[s._v("vgremove ：删除一个VG。")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## vgcreate [-s N[mgt]] VG名称PV名称")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 选项与参数：")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## -s ：后面接PE 的大小(size) ，单位可以是m, g, t (大小写均可)")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 1.将/dev/sda5-7建立成为一个VG，且指定PE为16MB！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgcreate -s 16M kiyonvg /dev/sda{5,6,7}")]),s._v("\n  Volume group "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonvg"')]),s._v(" successfully created\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgscan")]),s._v("\n  Reading volume "),n("span",{attrs:{class:"token function"}},[s._v("groups")]),s._v(" from cache.\n  Found volume group "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonvg"')]),s._v(" using metadata "),n("span",{attrs:{class:"token function"}},[s._v("type")]),s._v(" lvm2\n  Found volume group "),n("span",{attrs:{class:"token string"}},[s._v('"centos"')]),s._v(" using metadata "),n("span",{attrs:{class:"token function"}},[s._v("type")]),s._v(" lvm2\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvscan ")]),s._v("\n  PV /dev/sda5   VG kiyonvg         lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1008.00 MiB / 1008.00 MiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda6   VG kiyonvg         lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1008.00 MiB / 1008.00 MiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda7   VG kiyonvg         lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1008.00 MiB / 1008.00 MiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda3   VG centos          lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("30.00 GiB / 14.00 GiB free"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PV /dev/sda8                      lvm2 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  Total: 5 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("33.95 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" use: 4 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("32.95 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" / "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" no VG: 1 "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 有三个PV 被用去，剩下1 个/dev/sda8 的PV 没被用掉！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgdisplay kiyonvg")]),s._v("\n  --- Volume group ---\n  VG Name               kiyonvg\n  System ID\n  Format                lvm2\n  Metadata Areas        3\n  Metadata Sequence No  1\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                0\n  Open LV               0\n  Max PV                0\n  Cur PV                3\n  Act PV                3\n  VG Size               2.95 GiB\n  PE Size               16.00 MiB\n  Total PE              189\n  Alloc PE / Size       0 / 0\n  Free  PE / Size       189 / 2.95 GiB\n  VG UUID               cBoibr-y9mY-90Cl-SRSr-1DAY-lLAZ-Ecbl4u\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 最后那三行指的就是PE 能够使用的情况！由于尚未切出LV，因此所有的PE 均可自由使用。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 2.将剩余的PV (/dev/sda8)丢给kiyonvg")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgextend kiyonvg /dev/sda8")]),s._v("\n  Volume group "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonvg"')]),s._v(" successfully extended\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgdisplay kiyonvg ")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## ....(前面省略)....")]),s._v("\n  VG Size               3.94 GiB\n  PE Size               16.00 MiB\n  Total PE              252\n  Alloc PE / Size       0 / 0\n  Free  PE / Size       252 / 3.94 GiB\n  VG UUID               cBoibr-y9mY-90Cl-SRSr-1DAY-lLAZ-Ecbl4u\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"_3-lv-阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-lv-阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. LV 阶段")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ul",[n("li",[s._v("lvcreate ：建立LV！")]),s._v(" "),n("li",[s._v("lvscan ：查询系统上面的LV ；")]),s._v(" "),n("li",[s._v("lvdisplay ：显示系统上面的LV 状态！")]),s._v(" "),n("li",[s._v("lvextend ：在LV 里面增加容量！")]),s._v(" "),n("li",[s._v("lvreduce ：在LV 里面减少容量；")]),s._v(" "),n("li",[s._v("lvremove ：删除一个LV ！")]),s._v(" "),n("li",[s._v("lvresize ：对LV 进行容量大小的调整！")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("命令详解：\n"),t("code",[this._v("lvcreate [-LN[mgt]] [-n LV名称] VG名称")]),this._v(" "),t("code",[this._v("lvcreate [-l N] [-n LV名称] VG名称")]),this._v("\n选项与参数：")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("-L ：后面接容量，容量的单位可以是M,G,T 等，要注意的是，最小单位为PE，\n因此这个数量必须要是PE 的倍数，若不相符，系统会自行计算最相近的容量。")]),this._v(" "),t("li",[this._v("-l ：后面可以接PE 的『个数』，而不是数量。若要这么做，得要自行计算PE 数。")]),this._v(" "),t("li",[this._v("-n ：后面接的就是LV 的名称！")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.将kiyonvg分2GB给kiyonlv！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvcreate -L 2G -n kiyonlv kiyonvg")]),s._v("\n  Logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonlv"')]),s._v(" created\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 由于本案例中每个PE 为16M ，如果要用PE 的数量来处理的话，那使用下面的指令也OK！")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## lvcreate -l 128 -n kiyonlv kiyonvg")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvscan ")]),s._v("\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/kiyonvg/kiyonlv'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/root'")]),s._v("     "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/home'")]),s._v("     "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/swap'")]),s._v("     "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvdisplay /dev/kiyonvg/kiyonlv")]),s._v("\n  --- Logical volume ---\n  LV Path                /dev/kiyonvg/kiyonlv\n  LV Name                kiyonlv\n  VG Name                kiyonvg\n  LV UUID                1t1324-TfsC-bx5M-P9Ee-MeMK-Cjs3-m94yH2\n  LV Write Access        read/write\n  LV Creation host, "),n("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" study.centos.kiyon, 2017-04-21 14:18:30 +0800\n  LV Status              available\n  "),n("span",{attrs:{class:"token comment"}},[s._v("# open                 0")]),s._v("\n  LV Size                2.00 GiB\n  Current LE             128\n  Segments               3\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" to     8192\n  Block device           253:3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"文件系统阶段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件系统阶段","aria-hidden":"true"}},[this._v("#")]),this._v(" 文件系统阶段")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.格式化、挂载与观察我们的LV吧！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkfs.xfs /dev/kiyonvg/kiyonlv  #<==注意LV全名！")]),s._v("\nmeta-data"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/kiyonvg/kiyonlv   isize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("512    agcount"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4, agsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("131072 blks\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  attr"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2, projid32bit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       crc"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1        finobt"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0, sparse"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\ndata     "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("524288, imaxpct"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("25\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0      swidth"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 blks\nnaming   "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("version 2              bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   ascii-ci"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 ftype"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nlog      "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("internal log           bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2560, version"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 blks, lazy-count"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nrealtime "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("none                   extsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0, rtextents"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkdir /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mount /dev/kiyonvg/kiyonlv /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm")]),s._v("\nFilesystem                  Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv xfs   2.0G   33M  2.0G   2% /srv/lvm\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# cp -a /etc /var/log /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm")]),s._v("\nFilesystem                  Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv xfs   2.0G   74M  2.0G   4% /srv/lvm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"放大lv-容量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#放大lv-容量","aria-hidden":"true"}},[this._v("#")]),this._v(" 放大LV 容量")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ol",[t("li",[t("p",[this._v("VG阶段需要有剩余的容量：因为需要放大文件系统，所以需要放大LV，但是若没有多的VG容量，那么更上层的LV与文件系统就无法放大的。因此要用尽各种方法来产生多的VG容量才行。一般来说，如果VG容量不足，最简单的方法就是再加硬盘！然后将该硬盘使用上面讲过的pvcreate及vgextend增加到该VG内即可！")])]),this._v(" "),t("li",[t("p",[this._v("LV阶段产生更多的可用容量：如果VG的剩余容量足够了，此时就可以利用lvresize这个指令来将剩余容量加入到所需要增加的LV设备内！过程相当简单！")])]),this._v(" "),t("li",[t("p",[this._v("文件系统阶段的放大：我们的Linux实际使用的其实不是LV啊！而是LV这个设备内的文件系统！所以一切最终还是要以文件系统为依归！目前在Linux环境下，可以放大的文件系统有XFS以及EXT家族！至于缩小仅有EXT家族，目前XFS文件系统并不支持文件系统的容量缩小！要注意！要注意！XFS放大文件系统通过简单的xfs_growfs指令即可！")])])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.由前面的过程我们知道/srv/lvm是/dev/kiyonvg/kiyonlv这个设备，所以检查kiyonvg吧！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgdisplay kiyonvg")]),s._v("\n  --- Volume group ---\n  VG Name               kiyonvg\n  System ID\n  Format                lvm2\n  Metadata Areas        4\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                4\n  Act PV                4\n  VG Size               3.94 GiB\n  PE Size               16.00 MiB\n  Total PE              252\n  Alloc PE / Size       128 / 2.00 GiB\n  Free  PE / Size       124 / 1.94 GiB\n  VG UUID               cBoibr-y9mY-90Cl-SRSr-1DAY-lLAZ-Ecbl4u\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 既然VG 的容量够大了！所以直接来放大LV 吧！！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 2.放大LV吧！利用lvresize的功能来增加！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvresize -L +500M /dev/kiyonvg/kiyonlv")]),s._v("\n  Rounding size to boundary between physical extents: 512.00 MiB.\n  Size of logical volume kiyonvg/kiyonlv changed from 2.00 GiB "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("128 extents"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to 2.50 GiB "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("160 extents"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n  Logical volume kiyonvg/kiyonlv successfully resized.\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 这样就增加了LV 了！lvresize 的语法很简单，基本上同样通过-l 或-L 来增加！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvscan ")]),s._v("\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/kiyonvg/kiyonlv'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2.50 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/root'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/home'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n  ACTIVE            "),n("span",{attrs:{class:"token string"}},[s._v("'/dev/centos/swap'")]),s._v(" "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" inherit\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 可以发现/dev/kiyonvg/kiyonlv 容量由2G 增加到2.5G ！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm")]),s._v("\nFilesystem                  Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv xfs   2.0G   74M  2.0G   4% /srv/lvm\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 3.1先看一下原本的文件系统内的superblock记录情况吧！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# xfs_info /srv/lvm ")]),s._v("\nmeta-data"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/mapper/kiyonvg-kiyonlv isize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("512    agcount"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4, agsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("131072 blks\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  attr"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2, projid32bit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       crc"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1        finobt"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 spinodes"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\ndata     "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("524288, imaxpct"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("25\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0      swidth"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 blks\nnaming   "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("version 2              bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   ascii-ci"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 ftype"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nlog      "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("internal               bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2560, version"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 blks, lazy-count"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nrealtime "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("none                   extsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0, rtextents"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# xfs_growfs /srv/lvm   #这一步骤才是最重要的！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# xfs_info /srv/lvm ")]),s._v("\nmeta-data"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/dev/mapper/kiyonvg-kiyonlv isize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("512    agcount"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("5, agsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("131072 blks\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  attr"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2, projid32bit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       crc"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1        finobt"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 spinodes"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\ndata     "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("655360, imaxpct"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("25\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0      swidth"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 blks\nnaming   "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("version 2              bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   ascii-ci"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0 ftype"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nlog      "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("internal               bsize"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2560, version"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2\n         "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("                       sectsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096  sunit"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 blks, lazy-count"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\nrealtime "),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("none                   extsz"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("4096   blocks"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0, rtextents"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm")]),s._v("\nFilesystem                  Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv xfs   2.5G   74M  2.5G   3% /srv/lvm\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# ls -l /srv/lvm")]),s._v("\ntotal 16\ndrwxr-xr-x. 78 root root 8192 Apr 21 11:17 etc\ndrwxr-xr-x.  8 root root 4096 Apr 19 14:40 log\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 刚刚复制进去的资料可还是存在的！并没有消失不见！")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"使用lvm-thin-volume-让lvm-动态自动调整磁盘使用率"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用lvm-thin-volume-让lvm-动态自动调整磁盘使用率","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用LVM thin Volume 让LVM 动态自动调整磁盘使用率")])},function(){var s=this.$createElement,t=this._self._c||s;return t("ul",[t("li",[this._v("由kiyonvg 的剩余容量取出1GB 来做出一个名为kiyontpool 的thin pool LV 设备，这就是所谓的磁盘容量储存池(thin pool)")]),this._v(" "),t("li",[this._v("由kiyonvg 内的kiyontpool 产生一个名为kiyonthin 的10GB LV 设备")]),this._v(" "),t("li",[this._v("将此设备实际格式化为xfs 文件系统，并且挂载于/srv/thin 目录内！")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.先以lvcreate来建立kiyontpool这个thin pool设备： ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvcreate -L 1G -T kiyonvg/kiyontpool   #最重要的建置指令 ")]),s._v("\n  Using default stripesize 64.00 KiB.\n  Logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyontpool"')]),s._v(" created.\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvdisplay /dev/kiyonvg/kiyontpool")]),s._v("\n  --- Logical volume ---\n  LV Name                kiyontpool\n  VG Name                kiyonvg\n  LV UUID                dGEm2n-ARFT-OjI4-7Q85-bIp1-unqJ-X98pRu\n  LV Write Access        read/write\n  LV Creation host, "),n("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" study.centos.kiyon, 2017-04-21 15:02:50 +0800\n  LV Pool metadata       kiyontpool_tmeta\n  LV Pool data           kiyontpool_tdata\n  LV Status              available\n  "),n("span",{attrs:{class:"token comment"}},[s._v("# open                 0")]),s._v("\n  LV Size                1.00 GiB       "),n("span",{attrs:{class:"token comment"}},[s._v("# 总共可分配出去的容量 ")]),s._v("\n  Allocated pool data    0.00%          "),n("span",{attrs:{class:"token comment"}},[s._v("# 已分配的容量百分比 ")]),s._v("\n  Allocated metadata     0.24%          "),n("span",{attrs:{class:"token comment"}},[s._v("# 已分配的中介资料百分比")]),s._v("\n  Current LE             64\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" to     8192\n  Block device           253:6\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 非常有趣吧！竟然在LV 设备中还可以有再分配(Allocated) 的项目！果然是储存池！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvs kiyonvg   #语法为lvs VGname ")]),s._v("\n  LV         VG      Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  kiyonlv    kiyonvg -wi-ao---- 2.50g\n  kiyontpool kiyonvg twi-a-tz-- 1.00g             0.00   0.24\n"),n("span",{attrs:{class:"token comment"}},[s._v("#这个lvs指令的输出更加简单明了！直接看比较清晰！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 2.开始建立kiyonthin这个有10GB的设备，注意！必须使用--thin与kiyontpool连结！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvcreate -V 10G -T kiyonvg/kiyontpool -n kiyonthin")]),s._v("\n  Using default stripesize 64.00 KiB.\n  WARNING: Sum of all thin volume sizes "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.00 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" exceeds the size of thin pool kiyonvg/kiyontpool and the size of whole volume group "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("3.94 GiB"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("\n  For thin pool auto extension activation/thin_pool_autoextend_threshold should be below 100.\n  Logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonthin"')]),s._v(" created.\n  \n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvs kiyonvg")]),s._v("\n  LV         VG      Attr       LSize  Pool       Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  kiyonlv    kiyonvg -wi-ao----  2.50g\n  kiyonthin  kiyonvg Vwi-a-tz-- 10.00g kiyontpool        0.00\n  kiyontpool kiyonvg twi-aotz--  1.00g                   0.00   0.27\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 很有趣吧！明明连kiyonvg 这个VG 都没有足够大到10GB 的容量，通过thin pool")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 竟然就产生了10GB 的kiyonthin 这个设备！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 3.开始建立文件系统 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkfs.xfs /dev/kiyonvg/kiyonthin ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkdir /srv/thin ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mount /dev/kiyonvg/kiyonthin /srv/thin ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/thin")]),s._v("\nFilesystem                    Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonthin xfs    10G   33M   10G   1% /srv/thin\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 真的有10GB！！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 4.测试一下容量的使用！建立500MB的文件，但不可超过1GB的测试为宜！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# dd if=/dev/zero of=/srv/thin/test.img bs=1M count=500 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvs kiyonvg")]),s._v("\n  LV         VG      Attr       LSize  Pool       Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  kiyonlv    kiyonvg -wi-ao----  2.50g\n  kiyonthin  kiyonvg Vwi-aotz-- 10.00g kiyontpool        4.99\n  kiyontpool kiyonvg twi-aotz--  1.00g                   49.93  2.00\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 很要命！这时已经分配出49%以上的容量了！而kiyonthin却只看到用掉5%而已！")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 所以鸟哥认为，这个thin pool 非常好用！但是在管理上，得要特别特别的留意！")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"lvm-的lv-磁盘快照"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvm-的lv-磁盘快照","aria-hidden":"true"}},[this._v("#")]),this._v(" LVM 的LV 磁盘快照")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"传统快照区的建立"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#传统快照区的建立","aria-hidden":"true"}},[this._v("#")]),this._v(" 传统快照区的建立")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.先观察VG还剩下多少剩余容量 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgdisplay kiyonvg ")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## ....(其他省略)....")]),s._v("\n  Total PE              252\n  Alloc PE / Size       226 / 3.53 GiB\n  Free  PE / Size       26 / 416.00 MiB\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 就只有剩下26个PE了！全部分配给kiyonsnap1！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 2.利用lvcreate建立kiyonlv的快照区，快照被取名为kiyonsnap1，且给予26个PE ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvcreate -s -l 26 -n kiyonsnap1 /dev/kiyonvg/kiyonlv")]),s._v("\n  Logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonsnap1"')]),s._v(" created\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 上述的指令中最重要的是那个-s 的选项！代表是snapshot 快照功能的意思！")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## -n 后面接快照区的设备名称， /dev/.... 则是要被快照的LV 完整档名。")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## -l 后面则是接使用多少个PE 来作为这个快照区使用。")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvdisplay /dev/kiyonvg/kiyonsnap1")]),s._v("\n  --- Logical volume ---\n  LV Path                /dev/kiyonvg/kiyonspan1\n  LV Name                kiyonspan1\n  VG Name                kiyonvg\n  LV UUID                08alSG-10xu-dRnP-CgfI-smCX-y8Xx-IPxtjw\n  LV Write Access        read/write\n  LV Creation host, "),n("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" study.centos.kiyon, 2017-04-22 09:13:12 +0800\n  LV snapshot status     active destination "),n("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" kiyonlv\n  LV Status              available\n  "),n("span",{attrs:{class:"token comment"}},[s._v("# open                 0")]),s._v("\n  LV Size                2.50 GiB\n  Current LE             160\n  COW-table size         416.00 MiB\n  COW-table LE           26\n  Allocated to snapshot  0.00%\n  Snapshot chunk size    4.00 KiB\n  Segments               1\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently "),n("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" to     8192\n  Block device           253:11\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkdir /srv/snapshot1 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mount -o nouuid /dev/kiyonvg/kiyonsnap1 /srv/snapshot1 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm /srv/ snapshot1")]),s._v("\nFilesystem                     Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv    xfs   2.5G   74M  2.5G   3% /srv/lvm\n/dev/mapper/kiyonvg-kiyonspan1 xfs   2.5G   74M  2.5G   3% /srv/snapshot1\n"),n("span",{attrs:{class:"token comment"}},[s._v("## /dev/kiyonvg/kiyonsnap1 会主动记录原kiyonlv 的内容！")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"利用快照区复原系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#利用快照区复原系统","aria-hidden":"true"}},[this._v("#")]),this._v(" 利用快照区复原系统")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 1.先将原本的/dev/kiyonvg/kiyonlv内容作些变更，增增减减一些目录吧！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# cp -a /usr/share/doc /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# rm -rf /srv/lvm/log ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# rm -rf /srv/lvm /etc/sysconfig ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# df -Th /srv/lvm /srv/snapshot1")]),s._v("\nFilesystem                     Type  Size  Used Avail Use% Mounted on\n/dev/mapper/kiyonvg-kiyonlv    xfs   2.5G  115M  2.4G   5% /srv/lvm\n/dev/mapper/kiyonvg-kiyonspan1 xfs   2.5G   74M  2.5G   3% /srv/snapshot1\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# ll /srv/lvm /srv/snapshot1")]),s._v("\n/srv/lvm:\ntotal 28K\ndrwxr-xr-x. 284 root root  12K Apr 19 14:26 doc\ndrwxr-xr-x.  77 root root 8.0K Apr 22 09:38 etc\n\n/srv/snapshot1:\ntotal 16K\ndrwxr-xr-x. 78 root root 8.0K Apr 21 11:17 etc\ndrwxr-xr-x.  8 root root 4.0K Apr 19 14:40 log\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 两个目录的内容看起来已经不太一样了！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvdisplay /dev/kiyonvg/kiyonsnap1")]),s._v("\n  --- Logical volume ---\n  LV Path /dev/kiyonvg/kiyonsnap1\n"),n("span",{attrs:{class:"token comment"}},[s._v("## ....(中间省略).... ")]),s._v("\n  Allocated to snapshot  13.12%\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 列出最重要的部份: 全部的容量已经被用掉了13.12%！")]),s._v("\n\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 2.利用快照区将原本的filesystem备份，使用xfsdump来处理！")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# xfsdump -l 0 -L lvm1 -M lvm1 -f /home/lvm.dump /srv/snapshot1 ")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 此时就会有一个备份资料/home/lvm.dump了！")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("## 3.将kiyonsnap1卸载并移除(因为里面的内容已经备份起来了) ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# umount /srv/snapshot1 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvremove /dev/kiyonvg/kiyonsnap1 ")]),s._v("\nDo you really want to remove active logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonsnap1"')]),s._v("? "),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n  Logical volume "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonsnap1"')]),s._v(" successfully removed\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# umount /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mkfs.xfs -f /dev/kiyonvg/kiyonlv ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# mount /dev/kiyonvg/kiyonlv /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root @study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# xfsrestore -f /home/lvm.dump -L lvm1 /srv/lvm ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# ll /srv/lvm")]),s._v("\ntotal 16K\ndrwxr-xr-x. 78 root root 8.0K Apr 21 11:17 etc\ndrwxr-xr-x.  8 root root 4.0K Apr 19 14:40 log\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"lvm-的关闭"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#lvm-的关闭","aria-hidden":"true"}},[this._v("#")]),this._v(" LVM 的关闭")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ul",[n("li",[s._v("先卸载系统上面的LVM 文件系统(包括快照与所有LV)；")]),s._v(" "),n("li",[s._v("使用lvremove 移除LV ；")]),s._v(" "),n("li",[s._v("使用vgchange -an VGname 让VGname 这个VG 不具有Active 的标志；")]),s._v(" "),n("li",[s._v("使用vgremove 移除VG：")]),s._v(" "),n("li",[s._v("使用pvremove 移除PV；")]),s._v(" "),n("li",[s._v("最后，使用fdisk 修改ID 回来！")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# umount /srv/lvm /srv/thin /srv/snapshot1 ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvs kiyonvg")]),s._v("\n  LV         VG      Attr       LSize  Pool       Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  kiyonlv    kiyonvg -wi-a-----  2.50g\n  kiyonthin  kiyonvg Vwi-a-tz-- 10.00g kiyontpool        4.99\n  kiyontpool kiyonvg twi-aotz--  1.00g                   49.93  1.83\n"),n("span",{attrs:{class:"token comment"}},[s._v("## 要注意！按顺序删除kiyonthin --\x3e kiyontpool --\x3e kiyonlv 比较好！")]),s._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvremove /dev/kiyonvg/kiyonthin")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# lvremove /dev/kiyonvg/kiyonlv ")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgchange -an kiyonvg")]),s._v("\n  0 logical volume"),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" volume group "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonvg"')]),s._v(" now active\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# vgremove kiyonvg")]),s._v("\n  Volume group "),n("span",{attrs:{class:"token string"}},[s._v('"kiyonvg"')]),s._v(" successfully removed\n\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@study ~"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{attrs:{class:"token comment"}},[s._v("# pvremove /dev/sda{5,6,7,8}")]),s._v("\n  Labels on physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda5"')]),s._v(" successfully wiped.\n  Labels on physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda6"')]),s._v(" successfully wiped.\n  Labels on physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda7"')]),s._v(" successfully wiped.\n  Labels on physical volume "),n("span",{attrs:{class:"token string"}},[s._v('"/dev/sda8"')]),s._v(" successfully wiped.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])}],!1,null,null,null);e.options.__file="鸟哥Linux基础-进阶文件系统管理-LVM.md";t.default=e.exports}}]);