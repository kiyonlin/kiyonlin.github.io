(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{234:function(t,_,v){"use strict";v.r(_);var e=v(2),a=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("div",{staticClass:"content"},[v("p",[v("code",[t._v("iptables")]),t._v(" 是各种防火墙的基础，需要系统学习。本篇先了解 "),v("code",[t._v("iptables")]),t._v(" 的一些基本概念。")]),t._v(" "),v("div",{staticClass:"warning custom-block"},[v("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),v("p",[t._v("本系列文章测试环境为 "),v("code",[t._v("centos 7")]),t._v("，"),v("code",[t._v("iptables")]),t._v(" 版本 "),v("code",[t._v("1.4.21")]),t._v("。")])]),t._v(" "),v("h2",{attrs:{id:"说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#说明","aria-hidden":"true"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),v("p",[v("code",[t._v("iptables")]),t._v(" 是用来设置、维护和检查 "),v("code",[t._v("Linux")]),t._v(" 内核的 "),v("code",[t._v("IP")]),t._v(" 包过滤规则的。用户可以定义不同的表，每个表都包含几个内部的链，也能包含用户定义的链。每个链都是一个规则列表，与对应的包进行匹配：每条规则指定应当如何处理与之相匹配的包，这被称作 "),v("code",[t._v("target")]),t._v("（目标），也可以跳向同一个表内的用户定义的链。"),v("sup",{staticClass:"footnote-ref"},[v("a",{attrs:{href:"#fn1",id:"fnref1"}},[t._v("[1]")])])]),t._v(" "),v("p",[t._v("一般 "),v("code",[t._v("iptables")]),t._v(" 设置都是从 "),v("code",[t._v("表")]),t._v(" 出发，到 "),v("code",[t._v("链")]),t._v("再到 "),v("code",[t._v("规则")]),t._v("。")]),t._v(" "),v("h2",{attrs:{id:"表"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#表","aria-hidden":"true"}},[t._v("#")]),t._v(" 表")]),t._v(" "),v("p",[v("code",[t._v("iptables")]),t._v(" 的核心之一就是 "),v("code",[t._v("table")]),t._v("，它是具有相同功能的规则集合。iptables 提供了5张表：")]),t._v(" "),v("ol",[v("li",[v("code",[t._v("filter")]),t._v(" - 主要提供过滤功能，是默认的表。")]),t._v(" "),v("li",[v("code",[t._v("nat")]),t._v(" - 主要提供网络地址转换功能，实现数据包转发，修改源地址与端口和目标地址与端口。")]),t._v(" "),v("li",[v("code",[t._v("mangle")]),t._v(" - 主要提供修改报文的功能。")]),t._v(" "),v("li",[v("code",[t._v("raw")]),t._v(" - 应用在不需要做 "),v("code",[t._v("nat")]),t._v(" 的情况下，以提高性能。")]),t._v(" "),v("li",[v("code",[t._v("security")]),t._v(" - 主要提供 "),v("code",[t._v("MAC")]),t._v(" 网络规则。")])]),t._v(" "),v("h2",{attrs:{id:"链"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#链","aria-hidden":"true"}},[t._v("#")]),t._v(" 链")]),t._v(" "),v("p",[t._v("报文需要经过一系列阶段，每个阶段可以应用各种规则，这样的一个阶段在 iptables 中称为"),v("code",[t._v("链(chain)")]),t._v("。各种阶段串起来就是一条"),v("code",[t._v("长链")]),t._v("。 iptables 中有5条默认的链：")]),t._v(" "),v("ul",[v("li",[t._v("PREROUTING")]),t._v(" "),v("li",[t._v("INPUT")]),t._v(" "),v("li",[t._v("FORWARD")]),t._v(" "),v("li",[t._v("OUTPUT")]),t._v(" "),v("li",[t._v("POSTROUTING")])]),t._v(" "),v("p",[t._v("用户也可以创建自定义链，但是只能被默认链调用。")]),t._v(" "),v("h2",{attrs:{id:"报文生命周期"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#报文生命周期","aria-hidden":"true"}},[t._v("#")]),t._v(" 报文生命周期")]),t._v(" "),v("p",[t._v("报文从网卡进入，从网卡流出，会经过5个生命周期，也就是上述的5条默认链。每条链上可以使用"),v("code",[t._v("相应的表组合")]),t._v("起来进行报文处理。当不同表处于同一条链上时，处理报文就会涉及到顺序，执行的优先级如下：")]),t._v(" "),v("p",[v("code",[t._v("raw")]),t._v(" -> "),v("code",[t._v("mangle")]),t._v(" -> "),v("code",[t._v("nat")]),t._v(" -> "),v("code",[t._v("filter")]),t._v(" -> "),v("code",[t._v("security")])]),t._v(" "),v("p",[t._v("总结成一张图：")]),t._v(" "),v("p",[v("img",{attrs:{src:"/iptables/lifecycle.jpg",alt:"报文生命周期"}})]),t._v(" "),v("p",[t._v("同时，我们也可以总结出5张表分别包含了哪些链：")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("表")]),t._v(" "),v("th",[t._v("链")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("raw")]),t._v(" "),v("td",[t._v("PREROUTING, OUTPUT")])]),t._v(" "),v("tr",[v("td",[t._v("mangle")]),t._v(" "),v("td",[t._v("PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTING")])]),t._v(" "),v("tr",[v("td",[t._v("nat")]),t._v(" "),v("td",[t._v("PREROUTING, INPUT, OUTPUT, POSTROUTING")])]),t._v(" "),v("tr",[v("td",[t._v("filter")]),t._v(" "),v("td",[t._v("INPUT, FORWARD, OUTPUT")])]),t._v(" "),v("tr",[v("td",[t._v("security")]),t._v(" "),v("td",[t._v("INPUT, FORWARD, OUTPUT")])])])]),t._v(" "),v("h2",{attrs:{id:"规则"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#规则","aria-hidden":"true"}},[t._v("#")]),t._v(" 规则")]),t._v(" "),v("p",[t._v("规则包含了匹配条件和 "),v("code",[t._v("target")]),t._v("，用来匹配报文信息。匹配不成功，则进行下一条规则检测；匹配成功后执行规则对应的 "),v("code",[t._v("target")]),t._v("。")]),t._v(" "),v("p",[v("code",[t._v("target")]),t._v(" 可以是基本 "),v("code",[t._v("target")]),t._v("，用户自定义链，或者扩展中的 "),v("code",[t._v("target")]),v("sup",{staticClass:"footnote-ref"},[v("a",{attrs:{href:"#fn2",id:"fnref2"}},[t._v("[2]")])]),t._v("。")]),t._v(" "),v("p",[t._v("基本 "),v("code",[t._v("target")]),t._v(" 包含：")]),t._v(" "),v("ul",[v("li",[t._v("ACCEPT: 让报文通过。")]),t._v(" "),v("li",[t._v("DROP: 丢弃报文。")]),t._v(" "),v("li",[t._v("RETURN: 停止遍历本链中的规则，将下一条规则置为"),v("code",[t._v("前一条")]),t._v("调用的链。")])]),t._v(" "),v("hr",{staticClass:"footnotes-sep"}),t._v(" "),v("section",{staticClass:"footnotes"},[v("ol",{staticClass:"footnotes-list"},[v("li",{staticClass:"footnote-item",attrs:{id:"fn1"}},[v("p",[t._v("man iptables 8 "),v("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1"}},[t._v("↩︎")])])]),t._v(" "),v("li",{staticClass:"footnote-item",attrs:{id:"fn2"}},[v("p",[t._v("man iptables-extensions 8 "),v("a",{staticClass:"footnote-backref",attrs:{href:"#fnref2"}},[t._v("↩︎")])])])])])])}],!1,null,null,null);a.options.__file="iptables-1-简介.md";_.default=a.exports}}]);