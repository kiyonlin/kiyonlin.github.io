(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{232:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("div",{staticClass:"content"},[t("p",[s._v("本章学习如何对 "),t("code",[s._v("iptables")]),s._v(" 规则进行管理。")]),s._v(" "),t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("本系列文章测试环境为 "),t("code",[s._v("centos 7")]),s._v("，"),t("code",[s._v("iptables")]),s._v(" 版本 "),t("code",[s._v("1.4.21")]),s._v("。")])]),s._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作","aria-hidden":"true"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),t("p",[s._v("iptables 中最常用的匹配条件就是源ip，源端口，目标ip，目标端口等。最常用的动作有 "),t("code",[s._v("ACCEPT")]),s._v("、"),t("code",[s._v("DROP")]),s._v("、"),t("code",[s._v("REJECT")]),s._v("等。")]),s._v(" "),t("h3",{attrs:{id:"初始化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化","aria-hidden":"true"}},[s._v("#")]),s._v(" 初始化")]),s._v(" "),t("p",[s._v("让我们先清空系统提供的默认规则，准备一个初始化环境：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -F INPUT\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 298 packets, 30644 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("因为 "),t("code",[s._v("filter")]),s._v(" 表的 "),t("code",[s._v("INPUT")]),s._v(" 链默认策略为 "),t("code",[s._v("ACCEPT")]),s._v(" ，所以所有到达本机的报文都会通过。")]),s._v(" "),t("h3",{attrs:{id:"测试机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试机","aria-hidden":"true"}},[s._v("#")]),s._v(" 测试机")]),s._v(" "),t("p",[s._v("准备另一台测试机，接下来的规则都会针对这台测试机而做：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" 10.211.55.19\nPING 10.211.55.19 "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.211.55.19"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 56"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("84"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.458 ms\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.268 ms\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("3 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.266 ms\n^C\n--- 10.211.55.19 "),t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n3 packets transmitted, 3 received, 0% packet loss, "),t("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" 2002ms\nrtt min/avg/max/mdev "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0.266/0.330/0.458/0.092 ms\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"增加规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 增加规则")]),s._v(" "),t("p",[t("code",[s._v("-I, --insert")]),s._v(" 选项可以增加规则。")]),s._v(" "),t("p",[t("code",[s._v("-j, --jump")]),s._v(" 接收 "),t("code",[s._v("target")]),s._v(" 作为参数。")]),s._v(" "),t("blockquote",[t("p",[s._v("添加一条规则，拒绝所有来自 "),t("code",[s._v("10.211.55.9")]),s._v(" 的报文")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -t filter -I INPUT -s 10.211.55.9 -j DROP\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 93 packets, 8970 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("再使用测试机 "),t("code",[s._v("ping")]),s._v(" 一下，会发现不通：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" 10.211.55.19                                      \nPING 10.211.55.19 "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.211.55.19"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 56"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("84"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n^C\n--- 10.211.55.19 "),t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n11 packets transmitted, 0 received, 100% packet loss, "),t("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" 10003ms\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("但是目标机器的报文量会增加(11个报文，总大小924b)：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 445 packets, 48402 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n   11   924 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("-A, --append")]),s._v(" 选项可以追加规则。")]),s._v(" "),t("blockquote",[t("p",[s._v("追加一条规则，接受所有来自 "),t("code",[s._v("10.211.55.9")]),s._v(" 的报文")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -A INPUT -s 10.211.55.9 -j ACCEPT\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 30 packets, 2072 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n   11   924 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n    0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("再次用测试机 "),t("code",[s._v("ping")]),s._v("，还是不通:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" 10.211.55.19                                      \nPING 10.211.55.19 "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.211.55.19"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 56"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("84"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n^C\n--- 10.211.55.19 "),t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n5 packets transmitted, 0 received, 100% packet loss, "),t("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" 4001ms\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("查看现在规则情况:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 904 packets, 100K bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n    0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("我们可以看到第一条规则报文量更新了，但是第二条规则并未收到任何数据。")]),s._v(" "),t("p",[t("code",[s._v("-s, --source")]),s._v(" 选项指定源IP地址。")]),s._v(" "),t("blockquote",[t("p",[s._v("添加一条规则，接受所有来自 "),t("code",[s._v("10.211.55.9")]),s._v(" 的报文")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -I INPUT -s 10.211.55.9 -j ACCEPT\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 92 packets, 8870 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n    0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("现在第一条规则接受所有来自 "),t("code",[s._v("10.211.55.9")]),s._v(" 的报文，再使用测试机 "),t("code",[s._v("ping")]),s._v(" 一下：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" 10.211.55.19                                      \nPING 10.211.55.19 "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.211.55.19"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 56"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("84"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.367 ms\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.296 ms\n64 bytes from 10.211.55.19: icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("3 ttl"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("64 time"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0.278 ms\n^C\n--- 10.211.55.19 "),t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n3 packets transmitted, 3 received, 0% packet loss, "),t("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" 2001ms\nrtt min/avg/max/mdev "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" 0.278/0.313/0.367/0.043 ms\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("又可以 ping 通了，而且第一条规则的报文数据也发生了改变：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 15096 packets, 1693K bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    3   252 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n    0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("从这里，我们可以看出 "),t("code",[s._v("iptables")]),s._v(" 的工作机制：只要匹配了一条规则，就不会再去匹配接下来的规则。")]),s._v(" "),t("blockquote",[t("p",[s._v("在指定顺序规则前添加一条规则")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -I INPUT 2 -s 10.211.55.9 -j DROP\niptables -nvL INPUT --line\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 236 packets, 23798 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n1        3   252 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n2        0     0 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n3       16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n4        0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"删除规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 删除规则")]),s._v(" "),t("p",[s._v("删除规则有两种方式：")]),s._v(" "),t("ul",[t("li",[s._v("根据序号删除")]),s._v(" "),t("li",[s._v("根据匹配条件删除")])]),s._v(" "),t("blockquote",[t("p",[s._v("根据序号删除指定规则")])]),s._v(" "),t("p",[s._v("先查看一下目前所有的规则：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -nvL INPUT --line\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 236 packets, 23798 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n1        3   252 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n2        0     0 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n3       16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n4        0     0 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("删除第4条规则，命令如下:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -D INPUT 4\niptables -nvL INPUT --line\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 108 packets, 8771 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nnum   pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n1        3   252 ACCEPT     all  --  *      *       10.211.55.9          0.0.0.0/0\n2        0     0 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n3       16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("blockquote",[t("p",[s._v("根据匹配条件进行删除")])]),s._v(" "),t("p",[s._v("我们删除 "),t("code",[s._v("target")]),s._v(" 是 "),t("code",[s._v("ACCEPT")]),s._v(" 的规则：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -D INPUT -s 10.211.55.9 -j ACCEPT\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 79 packets, 5905 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("blockquote",[t("p",[s._v("删除所有规则")])]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("-F, --flush")]),s._v(" 选项即可，我们在准备工作中已经操作过。")]),s._v(" "),t("h2",{attrs:{id:"修改规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 修改规则")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("-R, --replace")]),s._v(" 选项替换指定编号规则内容。")]),s._v(" "),t("blockquote",[t("p",[s._v("修改规则， "),t("code",[s._v("target")]),s._v(" 从 "),t("code",[s._v("DROP")]),s._v(" 改为 "),t("code",[s._v("REJECT")]),s._v("，源IP不变")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -R INPUT 1 -s 10.211.55.9 -j REJECT\niptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 282 packets, 24058 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 REJECT     all  --  *      *       10.211.55.9          0.0.0.0/0            reject-with icmp-port-unreachable\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("div",{staticClass:"warning custom-block"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("若不指定 "),t("code",[s._v("-s")]),s._v(" 内容，则默认会被设置为 "),t("code",[s._v("0.0.0.0/0")]),s._v("，这可能会导致严重错误（例如 "),t("code",[s._v("DROP")]),s._v("  或者 "),t("code",[s._v("REJECT")]),s._v(" 了所有报文，那么当前连接也会断开）。所以使用 "),t("code",[s._v("-R")]),s._v(" 命令可以理解为替换当前顺序的规则的所有内容，这些内容必须写全，而不能写一部分；也可以理解为先删除这条指定的规则，再在同一位置插入新规则。")])]),s._v(" "),t("h3",{attrs:{id:"drop-和-reject-的区别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#drop-和-reject-的区别","aria-hidden":"true"}},[s._v("#")]),s._v(" "),t("code",[s._v("DROP")]),s._v(" 和 "),t("code",[s._v("REJECT")]),s._v(" 的区别")]),s._v(" "),t("p",[s._v("将 "),t("code",[s._v("DROP")]),s._v(" 替换为 "),t("code",[s._v("REJECT")]),s._v(" 后，我们使用测试机 "),t("code",[s._v("ping")]),s._v(" 一下，看看两者的区别：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" 10.211.55.19                             \nPING 10.211.55.19 "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10.211.55.19"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 56"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("84"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\nFrom 10.211.55.19 icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1 Destination Port Unreachable\nFrom 10.211.55.19 icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("2 Destination Port Unreachable\nFrom 10.211.55.19 icmp_seq"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("3 Destination Port Unreachable\n^C\n--- 10.211.55.19 "),t("span",{attrs:{class:"token function"}},[s._v("ping")]),s._v(" statistics ---\n3 packets transmitted, 0 received, +3 errors, 100% packet loss, "),t("span",{attrs:{class:"token function"}},[s._v("time")]),s._v(" 2000ms\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("我们可以看到，"),t("code",[s._v("REJECT")]),s._v(" 会给出明确的回应，而不像 "),t("code",[s._v("DROP")]),s._v(" 体现为毫无反应。")]),s._v(" "),t("p",[s._v("此时我们再看看规则情况，第一条规则报文量也发生了改变，说明匹配到了这条规则：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -nvL INPUT\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 2844 packets, 248K bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    3   252 REJECT     all  --  *      *       10.211.55.9          0.0.0.0/0            reject-with icmp-port-unreachable\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"修改默认策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改默认策略","aria-hidden":"true"}},[s._v("#")]),s._v(" 修改默认策略")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("-P, --policy")]),s._v(" 选项修改链的默认策略，当链中没有规则，或者所有规则都未匹配时，则使用默认规则：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables -P FORWARD DROP\niptables -nvL\nChain INPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 112 packets, 8478 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    3   252 REJECT     all  --  *      *       10.211.55.9          0.0.0.0/0            reject-with icmp-port-unreachable\n   16  1344 DROP       all  --  *      *       10.211.55.9          0.0.0.0/0\n\nChain FORWARD "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy DROP 0 packets, 0 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 ACCEPT     all  --  *      virbr0  0.0.0.0/0            192.168.122.0/24     ctstate RELATED,ESTABLISHED\n    0     0 ACCEPT     all  --  virbr0 *       192.168.122.0/24     0.0.0.0/0\n    0     0 ACCEPT     all  --  virbr0 virbr0  0.0.0.0/0            0.0.0.0/0\n    0     0 REJECT     all  --  *      virbr0  0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable\n    0     0 REJECT     all  --  virbr0 *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable\n\nChain OUTPUT "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT 80 packets, 7108 bytes"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),t("span",{attrs:{class:"token function"}},[s._v("source")]),s._v("               destination\n    0     0 ACCEPT     udp  --  *      virbr0  0.0.0.0/0            0.0.0.0/0            udp dpt:68\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("h2",{attrs:{id:"保存规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#保存规则","aria-hidden":"true"}},[s._v("#")]),s._v(" 保存规则")]),s._v(" "),t("p",[s._v("通常情况下，我们对 "),t("code",[s._v("iptables")]),s._v(" 做的操作都是临时的。就好比在 "),t("code",[s._v("word")]),s._v(" 中写了一段话，假如强制关闭了 "),t("code",[s._v("word")]),s._v(" 或者重启了电脑，那么刚才所些的那段话也会消失。当我们保存成 "),t("code",[s._v("word")]),s._v(" 文件后， 那段话就不会丢失。同理，设置 "),t("code",[s._v("iptables")]),s._v(" 后也需要保存。")]),s._v(" "),t("p",[s._v("因为在 "),t("code",[s._v("centos 7")]),s._v(" 中，默认的防火墙服务是 "),t("code",[s._v("firewalld")]),s._v(" ，而不是 "),t("code",[s._v("iptables")]),s._v(" 。所以我们需要安装 "),t("code",[s._v("iptables")]),s._v(" 服务，替换默认防火墙。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" -y iptables-services\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 关闭 firewalld 服务")]),s._v("\nsystemctl stop firewalld\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 禁止 firewalld 服务开机启动")]),s._v("\nsystemctl disable firewalld\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 开启 iptables 服务")]),s._v("\nsystemctl start iptables\n"),t("span",{attrs:{class:"token comment"}},[s._v("# 设置 iptables 服务开机启动")]),s._v("\nsystemctl "),t("span",{attrs:{class:"token function"}},[s._v("enable")]),s._v(" iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("安装 iptables 服务成功后，即可保存规则：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save\niptables: Saving firewall rules to /etc/sysconfig/iptables:"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("  OK  "),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("我们可以看到，所有的规则被写入了 "),t("code",[s._v("/etc/sysconfig/iptables")]),s._v(" 文件。")]),s._v(" "),t("p",[s._v("这里还有一种手动保存方法，当我们运行 "),t("code",[s._v("iptables-save")]),s._v(" 命令时，会有将所有当前的规则输出：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables-save\n"),t("span",{attrs:{class:"token comment"}},[s._v("# Generated by iptables-save v1.4.21 on Fri Aug 17 16:51:10 2018")]),s._v("\n*security\n:INPUT ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2409:202386"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n*raw\n:PREROUTING ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2413:203008"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n*mangle\n:PREROUTING ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("2413:203008"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n*nat\n:PREROUTING ACCEPT "),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("4:622"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n*filter\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n-A INPUT -s 10.211.55.9/32 -j REJECT --reject-with icmp-port-unreachable\n-A INPUT -s 10.211.55.9/32 -j DROP\n"),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nCOMMIT\n"),t("span",{attrs:{class:"token comment"}},[s._v("# Completed on Fri Aug 17 16:51:10 2018")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("所以只要将输出重定向到 "),t("code",[s._v("/etc/sysconfig/iptables")]),s._v(" 文件，也可以完成保存操作:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables-save "),t("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysconfig/iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("同时可以使用 "),t("code",[s._v("iptables-restore")]),s._v(" 命令恢复 "),t("code",[s._v("iptables")]),s._v(" 规则，现有规则会被覆盖:")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("iptables-restore "),t("span",{attrs:{class:"token operator"}},[s._v("<")]),s._v(" /etc/sysconfig/iptables\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}],!1,null,null,null);e.options.__file="iptables-3-规则管理.md";a.default=e.exports}}]);