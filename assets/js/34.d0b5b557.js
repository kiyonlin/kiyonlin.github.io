(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{230:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._m(7),t._v(" "),t._m(8),t._v(" "),a("ul",[a("li",[a("code",[t._v("--algo {bm|kmp}")]),t._v(" 指定字符串匹配算法，必填选项(算法介绍可以参考这两篇文章"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/05/boyer-moore_string_search_algorithm.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("bm"),a("OutboundLink")],1),t._v("，"),a("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("kmp"),a("OutboundLink")],1),t._v(")")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12)]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._m(25),t._v(" "),t._m(26),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),t._m(33),a("hr",{staticClass:"footnotes-sep"}),t._v(" "),t._m(34)])},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("本章介绍三个实用的规则匹配扩展模块"),a("sup",{staticClass:"footnote-ref"},[a("a",{attrs:{href:"#fn1",id:"fnref1"}},[t._v("[1]")])]),t._v("："),a("code",[t._v("iprange")]),t._v(" 、"),a("code",[t._v("string")]),t._v(" 和 "),a("code",[t._v("time")]),t._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("本系列文章测试环境为 "),a("code",[t._v("centos 7")]),t._v("，"),a("code",[t._v("iptables")]),t._v(" 版本 "),a("code",[t._v("1.4.21")]),t._v("。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"iprange-扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#iprange-扩展","aria-hidden":"true"}},[this._v("#")]),this._v(" iprange 扩展")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("iptables")]),t._v(" 匹配IP地址时，"),a("code",[t._v("-s")]),t._v(" 和 "),a("code",[t._v("-d")]),t._v(" 选项只能指定离散的IP地址，不能指定连续的IP地址，这时候就需要 "),a("code",[t._v("iprange")]),t._v(" 扩展模块。该模块包含了两个选项：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("[!] --src-range from[-to]")]),this._v(" "),s("li",[this._v("[!] --dst-range from[-to]")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("拒绝来自 "),s("code",[this._v("10.211.54.111")]),this._v(" 到 "),s("code",[this._v("10.211.55.11")]),this._v(" 范围的IP地址报文")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -I INPUT -m iprange --src-range 10.211.55.3-10.211.55.11 -j DROP\niptables -nvL INPUT\nChain INPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 34 packets, 2308 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n    0     0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v(" IP range 10.211.55.3-10.211.55.11\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"string-扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#string-扩展","aria-hidden":"true"}},[this._v("#")]),this._v(" string 扩展")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("string")]),this._v(" 扩展可以匹配报文中的字符串或者字节流，是一个比较实用的扩展。该扩展的选项如下：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("code",[this._v("--from offset")]),this._v(" 指定在报文中的起始偏移量，默认为0，可选项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("code",[this._v("--to offset")]),this._v(" 指定在报文中的结束偏移量，默认是报文大小，可选项")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("code",[this._v("[!] --string pattern")]),this._v(" 匹配字符串")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("code",[this._v("[!] --hex-string pattern")]),this._v(" 匹配十六进制字节流")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下面让我们实际应用一下该扩展。这里我们在 "),s("code",[this._v("10.211.55.19")]),this._v(" 搭建了一个 "),s("code",[this._v("http")]),this._v(" 服务，包含两个页面：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" 10.211.55.19/drop.html -v                      \n* About to connect"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to 10.211.55.19 port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying 10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to 10.211.55.19 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /drop.html HTTP/1.1\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host: 10.211.55.19\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 200 OK\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Server: openresty/1.13.6.1\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Date: Thu, 23 Aug 2018 00:59:18 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Type: text/html\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Length: 8\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Last-Modified: Wed, 22 Aug 2018 09:11:45 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Connection: keep-alive\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" ETag: "),a("span",{attrs:{class:"token string"}},[t._v('"5b7d28d1-8"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Accept-Ranges: bytes\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("\ndrop\nme\n* Connection "),a("span",{attrs:{class:"token comment"}},[t._v("#0 to host 10.211.55.19 left intact")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("#####################################################")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" 10.211.55.19/hello.html -v                     \n* About to connect"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to 10.211.55.19 port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying 10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to 10.211.55.19 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /hello.html HTTP/1.1\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host: 10.211.55.19\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 200 OK\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Server: openresty/1.13.6.1\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Date: Thu, 23 Aug 2018 00:59:52 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Type: text/html\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Length: 12\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Last-Modified: Wed, 22 Aug 2018 09:11:59 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Connection: keep-alive\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" ETag: "),a("span",{attrs:{class:"token string"}},[t._v('"5b7d28df-c"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Accept-Ranges: bytes\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("\nhello world\n* Connection "),a("span",{attrs:{class:"token comment"}},[t._v("#0 to host 10.211.55.19 left intact")]),t._v("\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("拒绝包含 "),s("code",[this._v("world")]),this._v(" 字符串的报文")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -F OUTPUT\niptables -I OUTPUT -m string --algo kmp --string "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" -j REJECT\niptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 15 packets, 2432 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("因为我们要用测试机获取 "),a("code",[t._v("10.211.55.19")]),t._v(" 上的页面，所以 "),a("code",[t._v("iptables")]),t._v(" 规则要写在 "),a("code",[t._v("OUTPUT")]),t._v(" 链上。\n再使用测试机 "),a("code",[t._v("curl")]),t._v(" 一下 "),a("code",[t._v("hello.html")]),t._v(" 页面，发现无法获取页面内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" 10.211.55.19/hello.html -v                     \n* About to connect"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to 10.211.55.19 port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying 10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to 10.211.55.19 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /hello.html HTTP/1.1\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host: 10.211.55.19\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 200 OK\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Server: openresty/1.13.6.1\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Date: Thu, 23 Aug 2018 01:00:03 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Type: text/html\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Length: 12\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Last-Modified: Wed, 22 Aug 2018 09:11:59 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Connection: keep-alive\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" ETag: "),a("span",{attrs:{class:"token string"}},[t._v('"5b7d28df-c"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Accept-Ranges: bytes\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("                       \n^C\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("查看 "),s("code",[this._v("OUTPUT")]),this._v(" 链，拦截了96个报文：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 220 packets, 15689 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n   96  7704 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("blockquote",[a("p",[t._v("拒绝包含 "),a("code",[t._v("drop\\nme")]),t._v(" 字节流的报文\n查看 "),a("code",[t._v("ascii")]),t._v(" 表，可以知道 "),a("code",[t._v("\\n")]),t._v(" 的十六进制值为 "),a("code",[t._v("0A")]),t._v("。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -I OUTPUT -m string --algo kmp --hex-string "),a("span",{attrs:{class:"token string"}},[t._v('"drop|0A|me"')]),t._v(" -j REJECT\niptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 31 packets, 4008 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"|64726f700a6d65|"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n  108  8640 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v('"drop|0A|me"')]),t._v(" 被转化成了纯字节流字符串 "),a("code",[t._v('"|64726f700a6d65|"')]),t._v("。\n再使用测试机 "),a("code",[t._v("curl")]),t._v(" 一下 "),a("code",[t._v("drop.html")]),t._v(" 页面，发现无法获取页面内容：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("curl")]),t._v(" 10.211.55.19/drop.html -v                      \n* About to connect"),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" to 10.211.55.19 port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n*   Trying 10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n* Connected to 10.211.55.19 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("10.211.55.19"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" port 80 "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token comment"}},[t._v("#0)")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" GET /drop.html HTTP/1.1\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" User-Agent: curl/7.29.0\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Host: 10.211.55.19\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" Accept: */*\n"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" HTTP/1.1 200 OK\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Server: openresty/1.13.6.1\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Date: Thu, 23 Aug 2018 01:01:43 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Type: text/html\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Content-Length: 8\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Last-Modified: Wed, 22 Aug 2018 09:11:45 GMT\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Connection: keep-alive\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" ETag: "),a("span",{attrs:{class:"token string"}},[t._v('"5b7d28d1-8"')]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v(" Accept-Ranges: bytes\n"),a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("                      \n^C\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("查看 "),s("code",[this._v("OUTPUT")]),this._v(" 链，拦截了54个报文：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 490 packets, 34180 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n   54  4140 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"|64726f700a6d65|"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n  108  8640 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("code",[t._v("http")]),t._v(" 协议是基于 "),a("code",[t._v("tcp")]),t._v(" 协议的可靠连接，当客户端未得到响应时，会尝试重传，尝试一定次数后才确认请求失败。所以上述两条规则匹配到的报文数最后都会达到108。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 2202 packets, 279K bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n  108  8208 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"|64726f700a6d65|"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n  108  8640 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            STRING match  "),a("span",{attrs:{class:"token string"}},[t._v('"world"')]),t._v(" ALGO name kmp TO 65535 reject-with icmp-port-unreachable\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("注意")]),this._v(" "),s("p",[this._v("实验过程中，发现使用 "),s("code",[this._v("bm")]),this._v(" 算法时，无法匹配目标字符串。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"time扩展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#time扩展","aria-hidden":"true"}},[this._v("#")]),this._v(" time扩展")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("time")]),this._v(" 扩展可以匹配报文到达时间。该扩展的常用选项有：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("code",[t._v("--datestart YYYY[-MM[-DD[Thh[:mm[:ss]]]]]")])]),t._v(" "),a("li",[a("code",[t._v("--datestop YYYY[-MM[-DD[Thh[:mm[:ss]]]]]")])]),t._v(" "),a("li",[a("code",[t._v("--timestart hh:mm[:ss]")])]),t._v(" "),a("li",[a("code",[t._v("--timestop hh:mm[:ss]")])]),t._v(" "),a("li",[a("code",[t._v("[!] --monthdays day[,day...]")]),t._v(" 没有31的月份会忽略31，二月份还会忽略29，30")]),t._v(" "),a("li",[a("code",[t._v("[!] --weekdays day[,day...]")]),t._v(" 星期选项可以是 "),a("code",[t._v("1-7")]),t._v(" 的数字，或者英文缩写 "),a("code",[t._v("Mon")]),t._v(", "),a("code",[t._v("Tue")]),t._v(", "),a("code",[t._v("Wed")]),t._v(", "),a("code",[t._v("Thu")]),t._v(", "),a("code",[t._v("Fri")]),t._v(", "),a("code",[t._v("Sat")]),t._v(", "),a("code",[t._v("Sun")]),t._v("。只使用两个字母也是允许的："),a("code",[t._v("Mo")]),t._v(", "),a("code",[t._v("Tu")]),t._v(", "),a("code",[t._v("We")]),t._v(", "),a("code",[t._v("Th")]),t._v(", "),a("code",[t._v("Fr")]),t._v(", "),a("code",[t._v("Sa")]),t._v(", "),a("code",[t._v("Su")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("周六周日 00:00-00:06, 21:00-23:59 不提供网页服务")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("iptables -F OUTPUT\niptables -I OUTPUT -p tcp -m multiport --dports 80,443 -m "),a("span",{attrs:{class:"token function"}},[t._v("time")]),t._v(" --weekdays Sa,Su --timestart 21:00  --timestop 06:00 -j REJECT\niptables -nvL OUTPUT\nChain OUTPUT "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("policy ACCEPT 7 packets, 1272 bytes"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n pkts bytes target     prot opt "),a("span",{attrs:{class:"token keyword"}},[t._v("in")]),t._v("     out     "),a("span",{attrs:{class:"token function"}},[t._v("source")]),t._v("               destination\n    0     0 REJECT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            multiport dports 80,443 TIME from 21:00:00 to 06:00:00 on Sat,Sun UTC reject-with icmp-port-unreachable\n")])]),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("section",{staticClass:"footnotes"},[s("ol",{staticClass:"footnotes-list"},[s("li",{staticClass:"footnote-item",attrs:{id:"fn1"}},[s("p",[this._v("man iptables-extensions 8 "),s("a",{staticClass:"footnote-backref",attrs:{href:"#fnref1"}},[this._v("↩︎")])])])])])}],!1,null,null,null);e.options.__file="iptables-5-实用匹配扩展-iprange-string-time.md";s.default=e.exports}}]);